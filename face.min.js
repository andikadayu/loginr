var url_string=window.location.href,url=new URL(url_string),id=url.searchParams.get("id");document.getElementById("logas").innerHTML="Login As "+id;var video=document.querySelector("#video");function handleVideo(stream){video.srcObject=stream}function videoError(e){alert("Izinkan menggunakan webcam untuk demo!")}function takeSnapshot(){var img=document.createElement("img"),context;img.setAttribute("id","imageUpload");var width=video.offsetWidth,height=video.offsetHeight;canvas=document.createElement("canvas"),canvas.width=width,canvas.height=height,(context=canvas.getContext("2d")).drawImage(video,0,0,width,height),img.src=canvas.toDataURL("image/jpg"),document.body.appendChild(img),video.src="",add_data(),scanning()}function add_data(){var ids=Math.floor(1e5*Math.random()),today=new Date,date,time,dateTime,tanggal=today.getFullYear()+"-"+(today.getMonth()+1)+"-"+today.getDate()+" "+(today.getHours()+":"+today.getMinutes()+":"+today.getSeconds()),orang=id,database=firebase.database();firebase.database().ref("login/"+ids).set({orang:orang,tanggal:tanggal})}function scanning(){async function start(){const image=document.getElementById("imageUpload"),container=document.createElement("div");container.style.position="relative",document.body.append(container);const labeledFaceDescriptors=await loadLabeledImages(),faceMatcher=new faceapi.FaceMatcher(labeledFaceDescriptors,.6);document.body.append("Loaded"),container.append(image);const canvas=faceapi.createCanvasFromMedia(image);container.append(canvas);const displaySize={width:image.width,height:image.height};faceapi.matchDimensions(canvas,displaySize);const detections=await faceapi.detectAllFaces(image).withFaceLandmarks().withFaceDescriptors(),resizedDetections=faceapi.resizeResults(detections,displaySize),results=resizedDetections.map(d=>faceMatcher.findBestMatch(d.descriptor));results.forEach((result,i)=>{const box=resizedDetections[i].detection.box,drawBox=new faceapi.draw.DrawBox(box,{label:result.toString()});drawBox.draw(canvas)})}function loadLabeledImages(){const labels=["Andika"],faceDescriptors=[];return Promise.all(labels.map(async label=>{for(let i=1;i<=2;i++){const img=await faceapi.fetchImage(`/labeled_images/${label}/${i}.png`),fullFaceDescription=await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();if(!fullFaceDescription)throw new Error(`no faces detected for ${label}`);faceDescriptors.push(fullFaceDescription.descriptor)}return new faceapi.LabeledFaceDescriptors(label,faceDescriptors)}))}Promise.all([faceapi.nets.faceRecognitionNet.loadFromUri("/models"),faceapi.nets.faceLandmark68Net.loadFromUri("/models"),faceapi.nets.ssdMobilenetv1.loadFromUri("/models")]).then(start),getlocation()}function getlocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(position){var lat=position.coords.latitude,lon=position.coords.longitude,latlon=new google.maps.LatLng(lat,lon),mapholder=document.getElementById("mapholder");mapholder.style.height="250px",mapholder.style.width="100%";var myOptions={center:latlon,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}},map=new google.maps.Map(document.getElementById("mapholder"),myOptions),marker=new google.maps.Marker({position:latlon,map:map,title:"You are here!"});x.innerHTML="Latitude = "+position.coords.latitude+" Longitude = "+position.coords.longitude}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},handleVideo,videoError);